<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Socket.io</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.css">
    <link rel="stylesheet" href="/stylesheets/jquery-ui.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
    <h3 id="title"></h3>
    <p id="message"></p>

    <div class="container">
        <div class="row">
            <div id="chat-window" class="col-lg-12 bas box">
            </div>
        </div>
        <div class="row mtl">
            <div class="col-lg-10">
                <input type="text" class="form-control" id="txt-message">
            </div>
            <div class="col-lg-2">
                <button id="btn-post" class="btn btn-primary col-lg-12">Send Message!</button>
            </div>
        </div>
    </div>

    <script src="/javascripts/jquery-1.10.2.min.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/socket.io.min.js"></script>
    <script>
    $(document).ready(function() {
        console.log('yeah!');
        window.chatServer = io.connect('http://localhost:3000/');

        window.chatServer.on('connect', function(data) {
            while (!window.chatNickname)
                window.chatNickname = prompt('what is your chat name?');
            window.chatServer.emit('join', window.chatNickname);
            $('#txt-message').focus();
        });

        window.chatServer.on('messages', function(message) {
            insertMessage(message)
        });

        $('#btn-post').unbind('click').click(function() {
            var message = $('#txt-message').val();
            if (!message)
                return;
            window.chatServer.emit('messages', message);
            insertMessage({
                'nickname': 'Me',
                'message': message
            });
            $('#txt-message').val('').focus();
        });

        $('#txt-message').keypress(function(e) {
            var key = e.which;
            if (key == 13) {
                $('#btn-post').trigger('click');
            }
        });

        var insertMessage = function(data) {
            $('#chat-window').html($('#chat-window').html() + '<div class="row mts mbs"><div class="col-lg-1 text-center"><b>' + data.nickname + ' :' + '</b></div><div class="col-lg-11 text-left">' + data.message + '</div></div>');
        };

    });
    </script>
</body>

</html>
